version: '3.8'
services:
  backend:
    build: ../backend
    environment:
      - BKG_FORGE_DATABASE_URL=postgresql://forge:forge-secure@db:7643/forge?schema=public
      - BKG_FORGE_PORT=8444
    ports:
      - "8444:8444"
    depends_on:
      - db
  webui:
    image: node:20-alpine
    working_dir: /app
    volumes:
      - ../webui:/app
    command: sh -c "npm install && npm run dev -- --host --port 4177"
    ports:
      - "4177:4177"
    depends_on:
      - backend
  db:
    image: ankane/pgvector
    environment:
      - POSTGRES_DB=forge
      - POSTGRES_USER=forge
      - POSTGRES_PASSWORD=forge-secure
    ports:
      - "7643:5432"
    command: ["postgres", "-p", "5432"]
